# Profi - –°—Ç–∞—Ç—É—Å –¥–≤—É—Ö—ç—Ç–∞–ø–Ω–æ–π –æ–±—Ä–∞–±–æ—Ç–∫–∏

## ‚úÖ –í–´–ü–û–õ–ù–ï–ù–û

### 1. –°–æ–∑–¥–∞–Ω–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞

- ‚úÖ –¢–∞–±–ª–∏—Ü–∞ `profi_nomenclature_all` (–°–´–†–´–ï –¥–∞–Ω–Ω—ã–µ)
- ‚úÖ SQL –¥–ª—è —Å–æ–∑–¥–∞–Ω–∏—è —Ç–∞–±–ª–∏—Ü—ã: `create_nomenclature_all.sql`
- ‚úÖ SQL –¥–ª—è –æ—á–∏—Å—Ç–∫–∏: `cleanup_orphaned_data.sql`
- ‚úÖ –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è: `README_WORKFLOW.md`

### 2. –ü–∞—Ä—Å–µ—Ä –≥–æ—Ç–æ–≤

- ‚úÖ `parser_to_all_xlrd.py` - —Ä–∞–±–æ—Ç–∞–µ—Ç —Å .xls —á–µ—Ä–µ–∑ xlrd
- ‚úÖ –ü–∞—Ä—Å–∏—Ç –ø–æ font-size (–æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –∏–µ—Ä–∞—Ä—Ö–∏–∏ brand/model/part_type)
- ‚úÖ –°–æ—Ö—Ä–∞–Ω—è–µ—Ç –°–´–†–´–ï –¥–∞–Ω–Ω—ã–µ –±–µ–∑ –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
- ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç:
  - –¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º: `--test` (1 –≥–æ—Ä–æ–¥)
  - –û–¥–∏–Ω –≥–æ—Ä–æ–¥: `--city "–ú–æ—Å–∫–≤–∞"`
  - –í—Å–µ –≥–æ—Ä–æ–¥–∞: `--all`
  - –ë–µ–∑ –ë–î: `--no-db` (—Ç–æ–ª—å–∫–æ JSON)

### 3. –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–∞—Ä—Å–∏–Ω–≥–∞

**–¢–µ—Å—Ç–æ–≤—ã–π –∑–∞–ø—É—Å–∫ (1 –≥–æ—Ä–æ–¥ - –ú–æ—Å–∫–≤–∞):**
- –¢–æ–≤–∞—Ä–æ–≤: 4,651
- –í—Ä–µ–º—è: ~30 —Å–µ–∫—É–Ω–¥

**–ü–æ–ª–Ω—ã–π –∑–∞–ø—É—Å–∫ (–≤—Å–µ –≥–æ—Ä–æ–¥–∞):**
- –¢–æ–≤–∞—Ä–æ–≤: **78,888** üéâ
- –¢–æ—Ä–≥–æ–≤—ã—Ö —Ç–æ—á–µ–∫: 20 –∏–∑ 37
- –û—à–∏–±–æ–∫: 17 (–Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç—ã)
- –í—Ä–µ–º—è: ~15 –º–∏–Ω—É—Ç

### 4. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–∞–Ω–Ω—ã—Ö

**–°–´–†–´–ï –¥–∞–Ω–Ω—ã–µ** (–∫–∞–∫ –µ—Å—Ç—å –∏–∑ Excel):
```
brand_raw: "1. –ó–ê–ü–ß–ê–°–¢–ò –î–õ–Ø APPLE"
model_raw: "–ó–ê–ü–ß–ê–°–¢–ò –î–õ–Ø APPLE IPHONE"
part_type_raw: "–ê–ö–ë –î–õ–Ø IPHONE"
```

**–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –ø–æ –±—Ä–µ–Ω–¥–∞–º (—Å—ã—Ä—ã–º):**
```
~40,000 | 3. –ê–ö–°–ï–°–°–£–ê–†–´
~30,000 | 2. –ó–ê–ü–ß–ê–°–¢–ò –î–õ–Ø –°–û–¢–û–í–´–•
 ~8,000 | 1. –ó–ê–ü–ß–ê–°–¢–ò –î–õ–Ø APPLE
```

---

## üîÑ –í –ü–†–û–¶–ï–°–°–ï

### –ó–∞–≥—Ä—É–∑–∫–∞ –≤ –ë–î

**–°—Ç–∞—Ç—É—Å:** ‚è≥ –ü–∞—Ä—Å–∏–Ω–≥ —Å –∑–∞–≥—Ä—É–∑–∫–æ–π –≤ –ë–î (–∑–∞–ø—É—â–µ–Ω –≤ —Ñ–æ–Ω–µ)

**–ö–æ–º–∞–Ω–¥–∞:**
```bash
python parser_to_all_xlrd.py --all
```

**–û–∂–∏–¥–∞–µ—Ç—Å—è:**
- –í—Å–µ 78,888 —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ `profi_nomenclature_all`
- –§–ª–∞–≥ `processed = false` (–≥–æ—Ç–æ–≤—ã –¥–ª—è n8n)

---

## ‚è≠Ô∏è –°–õ–ï–î–£–Æ–©–ò–ô –®–ê–ì

### –≠–¢–ê–ü 2: –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –≤ n8n

–ü–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –≤ –ë–î:

1. **–û—Ç–∫—Ä—ã—Ç—å n8n**
   ```
   http://85.198.98.104:5678
   ```

2. **–ò–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å workflow**
   ```
   SHOPS/Profi/Workflow/Upload.json
   ```

3. **–û–±–Ω–æ–≤–∏—Ç—å workflow –¥–ª—è —á—Ç–µ–Ω–∏—è –∏–∑ –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã**

   **–ë—ã–ª–æ:**
   ```sql
   SELECT * FROM PROFI_price_for_update
   ```

   **–°—Ç–∞–ª–æ:**
   ```sql
   SELECT * FROM profi_nomenclature_all WHERE processed = false
   ```

4. **–ó–∞–ø—É—Å—Ç–∏—Ç—å –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—é**
   - Upload.json –ø—Ä–∏–º–µ–Ω–∏—Ç –≤—Å—é –ª–æ–≥–∏–∫—É –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏
   - –†–µ–∑—É–ª—å—Ç–∞—Ç ‚Üí `profi_nomenclature` (—Ñ–∏–Ω–∞–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞)

5. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ–∑—É–ª—å—Ç–∞—Ç**
   ```sql
   SELECT COUNT(*) FROM profi_nomenclature;
   SELECT brand, COUNT(*) FROM profi_nomenclature GROUP BY brand ORDER BY COUNT(*) DESC LIMIT 10;
   ```

---

## üìã –§–∞–π–ª—ã –ø—Ä–æ–µ–∫—Ç–∞

```
SHOPS/Profi/
‚îú‚îÄ‚îÄ parser_to_all_xlrd.py           ‚Üê –≠–¢–ê–ü 1: –ü–∞—Ä—Å–µ—Ä (.xls —á–µ—Ä–µ–∑ xlrd)
‚îú‚îÄ‚îÄ load_to_db_bulk.py              ‚Üê –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π: –º–∞—Å—Å–æ–≤–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
‚îú‚îÄ‚îÄ create_nomenclature_all.sql     ‚Üê SQL: —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã
‚îú‚îÄ‚îÄ cleanup_orphaned_data.sql       ‚Üê SQL: –æ—á–∏—Å—Ç–∫–∞
‚îú‚îÄ‚îÄ README_WORKFLOW.md              ‚Üê –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø—Ä–æ—Ü–µ—Å—Å–∞
‚îú‚îÄ‚îÄ STATUS.md                       ‚Üê –≠—Ç–æ—Ç —Ñ–∞–π–ª (—Å—Ç–∞—Ç—É—Å)
‚îú‚îÄ‚îÄ Workflow/
‚îÇ   ‚îú‚îÄ‚îÄ Upload.json                 ‚Üê –≠–¢–ê–ü 2: n8n –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è (–Ω—É–∂–Ω–æ –æ–±–Ω–æ–≤–∏—Ç—å!)
‚îÇ   ‚îî‚îÄ‚îÄ Normalize_v2.json           ‚Üê LEGACY (—Ç–æ–ª—å–∫–æ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏)
‚îî‚îÄ‚îÄ data/
    ‚îî‚îÄ‚îÄ products.json               ‚Üê –†–µ–∑—É–ª—å—Ç–∞—Ç –ø–∞—Ä—Å–∏–Ω–≥–∞ (JSON)
```

---

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ù–µ–¥–æ—Å—Ç—É–ø–Ω—ã–µ –ø—Ä–∞–π—Å-–ª–∏—Å—Ç—ã (17 –∏–∑ 37)

**–ü—Ä–∏—á–∏–Ω–∞:** –ù–µ–∫–æ—Ç–æ—Ä—ã–µ URL –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç –æ—à–∏–±–∫—É 404 –∏–ª–∏ timeout

**–ì–æ—Ä–æ–¥–∞ —Å –ø—Ä–æ–±–ª–µ–º–∞–º–∏:**
- –°–∞–Ω–∫—Ç-–ü–µ—Ç–µ—Ä–±—É—Ä–≥ (2 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞)
- –ö—Ä–∞—Å–Ω–æ—è—Ä—Å–∫ (2 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞)
- –ö–∞–∑–∞–Ω—å (2 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞)
- –ö–∞–ª–∏–Ω–∏–Ω–≥—Ä–∞–¥ (2 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞)
- –ù–∏–∂–Ω–∏–π –ù–æ–≤–≥–æ—Ä–æ–¥ (2 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞)
- –û–º—Å–∫ (2 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞)
- –†–æ—Å—Ç–æ–≤-–Ω–∞-–î–æ–Ω—É (2 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞)
- –£–ª—å—è–Ω–æ–≤—Å–∫ (1 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç)
- –ï–∫–∞—Ç–µ—Ä–∏–Ω–±—É—Ä–≥ (1 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç)
- –•–∞–±–∞—Ä–æ–≤—Å–∫ (1 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç)

**–†–µ—à–µ–Ω–∏–µ:**
- –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å URL –≤ `price_lists_config.py`
- –ò–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `--dynamic` –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å–ø–∏—Å–∫–∞

### 2. –û—Ç—Å—É—Ç—Å—Ç–≤–∏–µ —Ü–µ–Ω

**–ü—Ä–æ–±–ª–µ–º–∞:** –í –Ω–µ–∫–æ—Ç–æ—Ä—ã—Ö —Ç–æ–≤–∞—Ä–∞—Ö `price = 0.00`

**–ü—Ä–∏—á–∏–Ω–∞:**
- –ö–æ–ª–æ–Ω–∫–∞ "–¶–µ–Ω–∞" –Ω–µ –Ω–∞–π–¥–µ–Ω–∞ –∏–ª–∏ –ø—É—Å—Ç–∞—è –≤ Excel
- –§–æ—Ä–º–∞—Ç —Ü–µ–Ω—ã –Ω–µ —Ä–∞—Å–ø–æ–∑–Ω–∞–Ω –ø–∞—Ä—Å–µ—Ä–æ–º

**–†–µ—à–µ–Ω–∏–µ:** –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —ç–≤—Ä–∏—Å—Ç–∏–∫—É –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –∫–æ–ª–æ–Ω–æ–∫ –≤ `_resolve_columns()`

---

## üìä –ú–µ—Ç—Ä–∏–∫–∏

### –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

- –°–∫–∞—á–∏–≤–∞–Ω–∏–µ 1 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞: ~2-5 —Å–µ–∫—É–Ω–¥
- –ü–∞—Ä—Å–∏–Ω–≥ 1 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–∞: ~15-25 —Å–µ–∫—É–Ω–¥
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤ –ë–î (100 —Ç–æ–≤–∞—Ä–æ–≤): ~5 —Å–µ–∫—É–Ω–¥
- –ó–∞–≥—Ä—É–∑–∫–∞ –≤ –ë–î (78,888 —Ç–æ–≤–∞—Ä–æ–≤): ~15-20 –º–∏–Ω—É—Ç

### –†–∞–∑–º–µ—Ä—ã

- 1 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç (Excel): ~1-2 MB
- products.json (78,888 —Ç–æ–≤–∞—Ä–æ–≤): ~25-30 MB
- profi_nomenclature_all (–≤ –ë–î): ~15-20 MB

---

## üîß –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –≤ –ë–î
psql -h aws-1-eu-west-3.pooler.supabase.com -U postgres.griexhozxrqtepcilfnu -d postgres -c "
  SELECT
    COUNT(*) as total,
    COUNT(*) FILTER (WHERE processed = false) as pending,
    COUNT(DISTINCT brand_raw) as brands
  FROM profi_nomenclature_all;
"

# –¢–æ–ø –±—Ä–µ–Ω–¥–æ–≤ (—Å—ã—Ä—ã–µ)
psql ... -c "
  SELECT brand_raw, COUNT(*) as cnt
  FROM profi_nomenclature_all
  GROUP BY brand_raw
  ORDER BY cnt DESC
  LIMIT 10;
"

# –ü—Ä–∏–º–µ—Ä—ã —Ç–æ–≤–∞—Ä–æ–≤ Apple
psql ... -c "
  SELECT name, brand_raw, model_raw, part_type_raw
  FROM profi_nomenclature_all
  WHERE brand_raw LIKE '%APPLE%'
  LIMIT 5;
"
```

---

## ‚úÖ –ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ –≠–¢–ê–ü 1

- [x] –¢–∞–±–ª–∏—Ü–∞ —Å–æ–∑–¥–∞–Ω–∞
- [x] –ü–∞—Ä—Å–µ—Ä —Ä–∞–±–æ—Ç–∞–µ—Ç
- [x] –í—Å–µ 37 –ø—Ä–∞–π—Å-–ª–∏—Å—Ç–æ–≤ –æ–±—Ä–∞–±–æ—Ç–∞–Ω—ã (20 —É—Å–ø–µ—à–Ω–æ, 17 —Å –æ—à–∏–±–∫–∞–º–∏)
- [ ] –í—Å–µ 78,888 —Ç–æ–≤–∞—Ä–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω—ã –≤ –ë–î ‚Üê **–í –ü–†–û–¶–ï–°–°–ï**
- [ ] –§–ª–∞–≥ `processed = false` —É –≤—Å–µ—Ö —Ç–æ–≤–∞—Ä–æ–≤
- [ ] –î–∞–Ω–Ω—ã–µ –≥–æ—Ç–æ–≤—ã –¥–ª—è n8n

---

**–î–∞—Ç–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è:** 2026-01-26 18:40
**–ê–≤—Ç–æ—Ä:** Claude Code
**–í–µ—Ä—Å–∏—è:** 1.0
